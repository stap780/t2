<%= search_form_for @search, html: { class: 'bg-white rounded-lg shadow p-4 mb-4', data: { controller: "filter", turbo_frame: '_top' }  } do |f| %>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="md:col-span-2">
        <%= f.label :title_or_variants_sku_or_variants_barcode_cont, t('products.index.search_label'), class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= f.search_field :title_or_variants_sku_or_variants_barcode_cont, value: params.dig(:q, :title_or_variants_sku_or_variants_barcode_cont), placeholder: t('products.index.search_by_title_sku'), class: "w-full px-3 py-2 border border-gray-300 rounded-md" %>
        </div>

        <div data-controller="checkbox">
            <div class="block text-sm font-medium text-gray-700 mb-1"><%= t('products.index.quantity') %></div>
            <div class="flex flex-wrap gap-4">
                <div class="flex items-center space-x-2">
                <%= f.check_box :all_quantity, {
                        checked: params.dig('q', 'all_quantity') == '1',
                        class: 'rounded border-gray-300 text-blue-600 shadow-sm focus:ring focus:ring-blue-200',
                        data: { checkbox_target: "btn", action: "change->checkbox#toggleOne" }
                    } %>
                <%= f.label :all_quantity, 'all', class: 'text-sm text-gray-700' %>
                </div>
                <div class="flex items-center space-x-2">
                <%= f.check_box :no_quantity, {
                        checked: params.dig('q', 'no_quantity') == '1',
                        class: 'rounded border-gray-300 text-blue-600 shadow-sm focus:ring focus:ring-blue-200',
                        data: { checkbox_target: "btn", action: "change->checkbox#toggleOne" }
                    } %>
                <%= f.label :no_quantity, '= 0', class: 'text-sm text-gray-700' %>
                </div>
                <div class="flex items-center space-x-2" <%= params.dig('q', 'yes_quantity') %> >
                <%= f.check_box :yes_quantity, {
                        checked: params.dig('q', 'yes_quantity') == '1',
                        include_hidden: false,
                        class: 'rounded border-gray-300 text-blue-600 shadow-sm focus:ring focus:ring-blue-200',
                        data: { checkbox_target: "btn", action: "change->checkbox#toggleOne" }
                    } %>
                <%= f.label :yes_quantity, '> 0', class: 'text-sm text-gray-700' %>
                </div>
            </div>
        </div>

        <div data-controller="checkbox">
        <div class="block text-sm font-medium text-gray-700 mb-1"><%= t('products.index.price') %></div>
        <div class="flex flex-wrap gap-4">
            <div class="flex items-center space-x-2">
            <%= f.check_box :no_price, {
                    checked: params.dig('q', 'no_price') == '1',
                    class: 'rounded border-gray-300 text-blue-600 shadow-sm focus:ring focus:ring-blue-200',
                    data: { checkbox_target: "btn", action: "change->checkbox#toggleOne" }
                } %>
            <%= f.label :no_price, '= 0', class: 'text-sm text-gray-700' %>
            </div>
            <div class="flex items-center space-x-2">
            <%= f.check_box :yes_price, {
                    checked: params.dig('q', 'yes_price') == '1',
                    class: 'rounded border-gray-300 text-blue-600 shadow-sm focus:ring focus:ring-blue-200',
                    data: { checkbox_target: "btn", action: "change->checkbox#toggleOne" }
                } %>
            <%= f.label :yes_price, '> 0', class: 'text-sm text-gray-700' %>
            </div>
        </div>
        </div>

        <div>
            <div class="block text-sm font-medium text-gray-700 mb-1"><%= t('products.index.created_at') %></div>
            <%= f.search_field :created_at_datebegin, value: params.dig(:q, :created_at_datebegin), placeholder: t('products.index.created_from'), class: "w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-100 cursor-pointer", autocomplete: "off", data: { controller: 'flatpickr', flatpickr_alt_input: "true", flatpickr_alt_format: "d-m-Y" } %>
        </div>
        <div>
            <div class="block text-sm font-medium text-gray-700 mb-1"><%= t('products.index.created_at') %></div>
            <%= f.search_field :created_at_dateend, value: params.dig(:q, :created_at_dateend), placeholder: t('products.index.created_to'), class: "w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-100 cursor-pointer", autocomplete: "off", data: { controller: 'flatpickr', flatpickr_alt_input: "true", flatpickr_alt_format: "d-m-Y" } %>
        </div>
        <div>
            <%= f.label :status_eq, class: "block text-sm font-medium text-gray-700 mb-1" %>
            <%= f.select :status_eq, options_for_select(Product::STATUS.map { |status| [t("enums.product.status.#{status}"), status] }, params.dig(:q, :status_eq)), { prompt: '' }, class: "w-full px-3 py-2 border border-gray-300 rounded-md" %>
        </div>
        <% if Property.find_by(handle: 'stantsiya').present? %>
            <% stantsiya_property = Property.find_by(handle: 'stantsiya') %>
            <% if stantsiya_property.characteristics.any? %>
                <div data-controller="checkbox">
                    <div class="block text-sm font-medium text-gray-700 mb-1">Склад</div>
                    <%= hidden_field_tag "q[features_characteristic_id_in][]", "" %>
                    <div class="flex flex-wrap gap-4">
                        <% stantsiya_property.characteristics.each do |characteristic| %>
                            <div class="flex items-center space-x-2">
                                <%= check_box_tag "q[features_characteristic_id_in][]", characteristic.id,
                                    params.dig(:q, :features_characteristic_id_in)&.include?(characteristic.id.to_s),
                                    {
                                        id: "q_features_characteristic_id_in_#{characteristic.id}",
                                        class: 'rounded border-gray-300 text-blue-600 shadow-sm focus:ring focus:ring-blue-200',
                                        data: { checkbox_target: "btn", action: "change->checkbox#toggle" }
                                    } %>
                                <%= label_tag "q_features_characteristic_id_in_#{characteristic.id}", characteristic.title, class: 'text-sm text-gray-700' %>
                            </div>
                        <% end %>
                    </div>
                </div>
            <% end %>
        <% end %>
        <div data-controller="checkbox">
            <div class="block text-sm font-medium text-gray-700 mb-1"><%= t('products.index.images') %></div>
            <div class="flex flex-wrap gap-4">
                <div class="flex items-center space-x-2">
                <%= f.check_box :with_images, {
                        checked: params.dig('q', 'with_images') == '1',
                        class: 'rounded border-gray-300 text-blue-600 shadow-sm focus:ring focus:ring-blue-200',
                        data: { checkbox_target: "btn", action: "change->checkbox#toggleOne" }
                    } %>
                <%= f.label :with_images, t('products.index.with_images'), class: 'text-sm text-gray-700' %>
                </div>
                <div class="flex items-center space-x-2">
                <%= f.check_box :without_images, {
                        checked: params.dig('q', 'without_images') == '1',
                        class: 'rounded border-gray-300 text-blue-600 shadow-sm focus:ring focus:ring-blue-200',
                        data: { checkbox_target: "btn", action: "change->checkbox#toggleOne" }
                    } %>
                <%= f.label :without_images, t('products.index.without_images'), class: 'text-sm text-gray-700' %>
                </div>
            </div>
        </div>
    </div>

    <div class="flex gap-2 mt-4">
        <%= f.submit "Применить", class: "px-4 py-2 bg-violet-600 text-white rounded-md hover:bg-violet-700" %>
        <%= link_to "Очистить", products_path(search_cancel: true), class: "px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300", data: { turbo_frame: '_top' } %>
    </div>
<% end %>
